---
sidebar_position: 3
---

# Immutable Schema による課題解決

スキーマ定義・入稿サイクルを気兼ねなく回すことのできる、デジタルアーカイブ用のDBMSを実現するため、APLLO v3 DBを開発する。

APLLO v3 DBは、特性1~4を満たすことのできるRDBMSとして作成するが、既存のRDBMSと異なり、特性4, 5をカバーする。

特性4, 5の実現のために、APLLO v3 DBは _Immutable Schema_ を実装する。

Immutable Schemaのコンセプトは、以下の2種類の不変性からなる。

- **Immutable DDL:**
  いかなるスキーマ変更も、過去に入稿したレコードのデータ変更を伴わない
- **Immutable DML:**
  いかなるレコード更新も、過去に入稿したレコードのデータを上書きにより失わない

特性4, 5は、このうちの Immutable DDL で担保される。特性5, 6で取り上げた例を用いて Immutable DDL により得られる恩恵を説明すると、以下のようになる。

- `"体験談" フィールドを "被爆者" スキーマから他のスキーマ移すことにしたので、第一手として "被爆者" スキーマから "体験談" フィールドを削除する` という操作をした。既存のレコードの "体験談" データは失われない。その代わり、これから "被爆者" スキーマのレコードを入稿する際、 "体験談" のデータは入力しない。体験談データを入稿するためには、他のスキーマに "体験談" フィールドを追加して、そこへ入力する。
- `"顧客" スキーマに "年齢" フィールドを、非NULLで追加する` 操作をした。これから入稿する "顧客" レコードには必ず年齢を入力する。過去に入稿したレコードは年齢が付与されていないが、「年齢が未入力のレコード」を一括絞り込みして、過去レコードに年齢を設定する作業を集中的に別のタイミングで行うことができる。
